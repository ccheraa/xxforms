<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events"
  xmlns:xx='http://www.xxforms.org/2025/xxforms' xmlns:xf="http://www.w3.org/2002/xforms">

<head>
  <title>Client-side routing</title>
  <xf:model id="main">
    <xf:instance id="test-data">
      <data xmlns="">
        <app-data>
          <!-- UI Configuration Data -->
          <ui-config>
            <menu-items>
              <item id="home" label="Home" icon="house" />
              <item id="customers" label="Customers" icon="users" />
              <item id="payments" label="Payments" icon="money-bill" />
              <item id="disputes" label="Disputes" icon="comment-dots" />
              <item id="balance" label="Balance" icon="cash-register" />
              <item id="radar" label="Radar" icon="satellite-dish" />
              <item id="billing" label="Billing" icon="file-invoice-dollar" />
              <item id="connect" label="Connect" icon="circle-nodes" />
              <item id="orders" label="Orders" icon="money-bill-transfer" />
              <item id="developers" label="Developers" icon="code" />
              <item id="settings" label="Settings" icon="gear" />
            </menu-items>

            <currency-options>
              <option value="GBP" label="GBP - British Pound" />
              <option value="USD" label="USD - US Dollar" />
              <option value="EUR" label="EUR - Euro" />
              <option value="JPY" label="JPY - Japanese Yen" />
              <option value="CAD" label="CAD - Canadian Dollar" />
            </currency-options>

            <payment-status-options>
              <option value="succeeded" label="Succeeded" />
              <option value="failed" label="Failed" />
              <option value="pending" label="Pending" />
              <option value="refunded" label="Refunded" />
            </payment-status-options>

            <filter-options>
              <filter id="status" label="Status" type="select" default="all">
                <option value="all" label="All" />
                <option value="succeeded" label="Succeeded" />
                <option value="failed" label="Failed" />
              </filter>
              <filter id="date-range" label="Date Range" type="date-picker" />
              <filter id="customer-email" label="Customer Email" type="text-input" />
            </filter-options>
          </ui-config>

          <!-- Application Data -->
          <application-data>
            <payments>
              <payment id="pay_1" amount="10.00" currency="GBP" status="succeeded" date="2019-05-02 21:05:46">
                <description>Initial setup fee</description>
                <customer-email>calum.moore@gmail.com</customer-email>
                <customer-id>cust_1</customer-id>
                <card-details last4="4242" expiry="12/24" brand="Visa" />
                <statement-description>Zeplo*SETUP</statement-description>
              </payment>
              <payment id="pay_2" amount="10.99" currency="USD" status="succeeded" date="2019-04-13 14:50:02">
                <description>Monthly subscription</description>
                <customer-email>june.doe@example.com</customer-email>
                <customer-id>cust_2</customer-id>
                <card-details last4="1234" expiry="01/25" brand="Mastercard" />
                <statement-description>Zeplo*SUB</statement-description>
              </payment>
              <payment id="pay_3" amount="10.99" currency="USD" status="succeeded" date="2019-04-10 15:00:00">
                <description>Product upgrade</description>
                <customer-email>alice.smith@example.com</customer-email>
                <customer-id>cust_3</customer-id>
                <card-details last4="9876" expiry="06/23" brand="Amex" />
                <statement-description>Zeplo*UPGRADE</statement-description>
              </payment>
              <payment id="pay_4" amount="4.40" currency="USD" status="failed" date="2019-03-15 14:58:38">
                <description>Failed transaction attempt</description>
                <customer-email>bob.brown@example.com</customer-email>
                <customer-id>cust_4</customer-id>
                <card-details last4="5678" expiry="11/22" brand="Visa" />
                <error-message>Insufficient funds</error-message>
                <statement-description>Zeplo*FAIL</statement-description>
              </payment>
              <payment id="pay_5" amount="3.58" currency="USD" status="succeeded" date="2019-03-08 13:00:00">
                <description>Small purchase</description>
                <customer-email>calum.moore@gmail.com</customer-email>
                <customer-id>cust_1</customer-id>
                <card-details last4="4242" expiry="12/24" brand="Visa" />
                <statement-description>Zeplo*PURCHASE</statement-description>
              </payment>
              <payment id="pay_6" amount="10.00" currency="GBP" status="succeeded" date="2018-04-23 22:18:19">
                <description>An extra special card - ch_19IphHCYUQHKiNglFtyqA0</description>
                <customer-email>calum.moore@gmail.com</customer-email>
                <customer-id>cust_1</customer-id>
                <card-details last4="1111" expiry="07/26" brand="Visa" />
                <statement-description>Zeplo*CHG</statement-description>
              </payment>
              <payment id="pay_7" amount="6.99" currency="GBP" status="succeeded" date="2017-02-21 22:08:37">
                <description>An extra special card - ch_19IphNCYUQHKiNglFtyqA0</description>
                <customer-email>calum.moore@gmail.com</customer-email>
                <customer-id>cust_1</customer-id>
                <card-details last4="2222" expiry="08/25" brand="Mastercard" />
                <statement-description>Zeplo*BILL</statement-description>
              </payment>
              <payment id="pay_8" amount="6.99" currency="GBP" status="succeeded" date="2017-02-21 22:06:17">
                <description>An extra special card - ch_19IphOCYUQHKiNglFtyqA0</description>
                <customer-email>calum.moore@gmail.com</customer-email>
                <customer-id>cust_1</customer-id>
                <card-details last4="3333" expiry="09/24" brand="Visa" />
                <statement-description>Zeplo*INV</statement-description>
              </payment>
            </payments>

            <customers>
              <customer id="cust_1" email="calum.moore@gmail.com" name="Calum Moore">
                <address>123 Main St, London, UK</address>
                <joined-date>2017-01-01</joined-date>
              </customer>
              <customer id="cust_2" email="june.doe@example.com" name="June Doe">
                <address>456 Oak Ave, New York, USA</address>
                <joined-date>2018-05-10</joined-date>
              </customer>
              <customer id="cust_3" email="alice.smith@example.com" name="Alice Smith">
                <address>789 Pine Ln, Sydney, Australia</address>
                <joined-date>2019-01-20</joined-date>
              </customer>
              <customer id="cust_4" email="bob.brown@example.com" name="Bob Brown">
                <address>101 Elm St, Berlin, Germany</address>
                <joined-date>2018-03-01</joined-date>
              </customer>
              <form>
                <customer id="" email="" name="">
                  <address></address>
                  <joined-date></joined-date>
                </customer>
                <next-customer-id>5</next-customer-id>
              </form>
            </customers>
          </application-data>
        </app-data>
        <current-page>/</current-page>
        <current-page-id />
        <current-customer-id />
        <search />
        <available-pages>
          <page>/</page>
          <page>home</page>
          <page>customers</page>
          <page>payments</page>
        </available-pages>
      </data>
    </xf:instance>
    <xf:action ev:event="xx-route-changed">
      <xf:setvalue ref="instance('test-data')/current-page"
        value="replace(event('route'), '^\\/([^/]+)(\\/.*)?$', '$1')" />
      <xf:setvalue ref="instance('test-data')/current-page-id"
        value="if(contains(substring-after(event('route'), '/'), '/'), replace(event('route'), '^\\/[^/]+\\/(.*)$', '$1'), '')" />
      <xf:show dialog="customer-info" if="instance('test-data')/current-page = 'customers' and instance('test-data')/current-page-id != ''" />
      <xf:hide dialog="customer-info" if="instance('test-data')/current-page != 'customers' or instance('test-data')/current-page-id = ''" />
    </xf:action>
  </xf:model>
  <style>
    body {
      margin: 0;
    }

    #app {
      display: grid;
      grid-template-rows: auto 1fr;
      grid-template-columns: auto 1fr;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      gap: 1em;
    }

    #topbar {
      grid-row: 1 / 2;
      grid-column: 2 / 3;
      padding: 1em;
    }

    #navbar {
      padding: 1em 0 1em 1em;
      grid-row: 1 / 3;
      grid-column: 1 / 2;
    }

    #app-body {
      grid-row: 2 / 3;
      grid-column: 2 / 3;
      overflow-x: hidden;
      overflow-y: auto;
    }

    #navbar .logo {
      font-size: 2em;
    }

    #navbar .nav {
      margin-top: 2em;
    }

    #navbar .nav xforms-repeat {
      display: flex;
      flex-direction: column;
      gap: 1em;
    }

    #navbar .nav a xforms-label {
      display: flex;
      align-items: center;
      gap: 1em;
    }

    #navbar .nav span.active a {
      color: var(--secondary-accent);
    }

    #navbar .nav a:hover {
      text-decoration: none;
    }

    .table-container {
      overflow: auto;
    }
    .table {
      width: 100%;
      display: grid;
    }

    .table xforms-repeat,
    .table xforms-repeat-item,
    .table xforms-group,
    .table xforms-body,
    .table .thead,
    .table .tbody,
    .table .tr {
      display: contents !important;
    }
    .table xforms-group[xf-notrelevant] {
      display: none !important;
    }
    .table .th {
      text-align: left;
      white-space: nowrap;
      padding: 0.5em;
    }

    .table .td {
      padding: 0.5em;
      white-space: nowrap;
    }

    .table .toolbar {
      display: flex;
      gap: 0.5em;
    }
    .table .toolbar button {
      --button-text: var(--color);
    }
    .table .toolbar xforms-hint {
      pointer-events: none;
    }

    .customers .table {
      grid-template-columns: auto auto auto auto auto;
    }

    .payments .table {
      grid-template-columns: auto auto auto auto auto auto;
    }

    dialog .dialog-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1em;
    }
  </style>
</head>

<body>
  <div id="app">
    <div id="topbar">
      <xf:input ref="instance('test-data')/search" />
      <xf:input ref="instance('test-data')/current-page" />
      <xf:input ref="instance('test-data')/current-customer-id" />
    </div>
    <div id="navbar">
      <div class="logo">
        <xx:icon fa="'gauge'" />&#160;LOGO
      </div>
      <div class="nav">
        <xf:repeat nodeset="instance('test-data')/app-data/ui-config/menu-items/item" id="menu-items">
          <span class="{if (@id = instance('test-data')/current-page, 'active', '')}">
            <xx:link
              route="concat('/', instance('test-data')/app-data/ui-config/menu-items/item[index('menu-items')]/@id)">
              <xx:icon fa="@icon" />
              <xf:output value="@label" />
            </xx:link>
          </span>
        </xf:repeat>
      </div>
    </div>
    <div id="app-body" class="card">
      <xf:group ref=".['/' = instance('test-data')/current-page or 'home' = instance('test-data')/current-page]">
        <h1>Home</h1>
      </xf:group>
      <xf:group ref=".['payments' = instance('test-data')/current-page]" class="payments">
        <h1>Payments</h1>
        <div class="table-container">
          <div class="table">
            <div class="thead">
              <div class="tr">
                <div class="th toolbar"></div>
                <div class="th">Email</div>
                <div class="th">description</div>
                <div class="th">amount</div>
                <div class="th">status</div>
                <div class="th">date</div>
              </div>
            </div>
            <div class="tbody">
              <xf:repeat nodeset="instance('test-data')/app-data/application-data/payments/payment" id="payments">
                <div class="tr">
                  <div class="td toolbar"></div>
                  <div class="td">
                    <xx:link route="concat('/customers/', instance('test-data')/app-data/application-data/payments/payment[index('payments')]/customer-id)">
                      <xf:output value="customer-email" />
                    </xx:link>
                  </div>
                  <div class="td">
                    <xf:output value="description" />
                  </div>
                  <div class="td" style="text-align: right;">
                    <xf:output value="@amount" />&#160;<xf:output value="@currency" />
                  </div>
                  <div class="td" style="color: var(--{if(@status='succeeded', 'success', 'error')}-color);">
                    <xx:icon fa="if(@status='succeeded', 'check', 'times')" />
                  </div>
                  <div class="td">
                    <xf:output value="@date" />
                  </div>
                </div>
              </xf:repeat>
            </div>
          </div>
        </div>
      </xf:group>
      <xf:group ref=".['customers' = instance('test-data')/current-page]" class="customers">
        <h1>Customers</h1>
        <div class="table-container">
          <div class="table">
            <div class="thead">
              <div class="tr">
                <div class="th toolbar">
                  <xf:trigger style="--color: var(--success-color);">
                    <xf:action ev:event="DOMActivate">
                      <xf:setvalue ref="instance('test-data')/current-customer-id" value="''" />
                      <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@id" value="''" />
                      <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@email" value="''" />
                      <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@name" value="''" />
                      <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/address" value="''" />
                      <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/joined-date" value="''" />
                      <xf:show dialog="customer-edit" />
                    </xf:action>
                    <xf:label><xx:icon fa="'plus'" /> Create</xf:label>
                  </xf:trigger>
                </div>
                <div class="th">Name</div>
                <div class="th">Email</div>
                <div class="th">Address</div>
                <div class="th">Joined Date</div>
              </div>
            </div>
            <div class="tbody">
              <xf:group ref=".[count(instance('test-data')/app-data/application-data/customers/customer) &gt; 0]">
                <xf:repeat nodeset="instance('test-data')/app-data/application-data/customers/customer" id="customers">
                  <div class="tr">
                    <div class="td toolbar">
                      <xx:button-group>
                        <xf:trigger style="--color: var(--error-color);">
                          <xf:hint>Delete</xf:hint>
                          <xf:action ev:event="DOMActivate">
                            <xf:setvalue ref="instance('test-data')/current-customer-id" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@id" />
                            <xf:show dialog="customer-delete" />
                          </xf:action>
                          <xf:label><xx:icon fa="'trash'" /></xf:label>
                        </xf:trigger>
                        <xf:trigger style="--color: var(--primary-accent);">
                          <xf:hint>Edit</xf:hint>
                          <xf:action ev:event="DOMActivate">
                            <xf:setvalue ref="instance('test-data')/current-customer-id" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@id" />
                            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@id" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@id" />
                            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@email" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@email" />
                            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@name" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@name" />
                            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/address" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/address" />
                            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/joined-date" value="instance('test-data')/app-data/application-data/customers/customer[index('customers')]/joined-date" />
                            <xf:show dialog="customer-edit" />
                          </xf:action>
                          <xf:label><xx:icon fa="'pencil'" /></xf:label>
                        </xf:trigger>
                        <xf:trigger>
                          <xf:action ev:event="DOMActivate">
                            <!-- <xx:go-to url="concat('/customers/', instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@id)" /> -->
                            <xx:go-to route="concat('/customers/', instance('test-data')/app-data/application-data/customers/customer[index('customers')]/@id)" />
                          </xf:action>
                          <xf:hint>Customer details</xf:hint>
                          <xf:label><xx:icon fa="'info'" /></xf:label>
                        </xf:trigger>
                      </xx:button-group>
                    </div>
                    <div class="td">
                      <xf:output value="@name" />
                    </div>
                    <div class="td">
                      <xf:output value="@email" />
                    </div>
                    <div class="td">
                      <xf:output value="address" />
                    </div>
                    <div class="td">
                      <xf:output value="joined-date" />
                    </div>
                  </div>
                </xf:repeat>
              </xf:group>
              <xf:group ref=".[count(instance('test-data')/app-data/application-data/customers/customer) = 0]">
                <p>No customers found</p>
              </xf:group>
            </div>
          </div>
        </div>
      </xf:group>
      <xf:group ref=".[not(instance('test-data')/available-pages/page = instance('test-data')/current-page)]">
        <h1>
          <xx:icon fa="'face-frown'" /> 404
        </h1>
        <h2>Page not found</h2>
      </xf:group>
    </div>
  </div>
  <dialog id="customer-delete">
    <p>Are you sure you want to delete this customer "<xf:output
        value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-customer-id]/@name" />"?</p>
    <div class="dialog-footer">
      <xf:trigger>
      <xf:label>Cancel</xf:label>
      <xf:hide ev:event="DOMActivate" dialog="customer-delete" />
    </xf:trigger>
    <xf:trigger>
      <xf:label>Delete</xf:label>
      <xf:action ev:event="DOMActivate">
        <xf:delete nodeset="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-customer-id]"/>
        <xf:hide dialog="customer-delete" />
      </xf:action>
    </xf:trigger>
    </div>
  </dialog>
  <dialog id="customer-edit">
    <xf:group ref=".[instance('test-data')/app-data/application-data/customers/form/customer/@id = '']">
      <p>Add new customer</p>
    </xf:group>
    <xf:group ref=".[not(instance('test-data')/app-data/application-data/customers/form/customer/@id = '')]">
      <p>Edit customer "<xf:output value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-customer-id]/@name" />"?</p>
    </xf:group>
    <dl>
      <dt>Name</dt>
      <dd><xf:input ref="instance('test-data')/app-data/application-data/customers/form/customer/@name" /></dd>
      <dt>Email</dt>
      <dd><xf:input ref="instance('test-data')/app-data/application-data/customers/form/customer/@email" /></dd>
      <dt>Address</dt>
      <dd><xf:textarea ref="instance('test-data')/app-data/application-data/customers/form/customer/address" /></dd>
      <dt>Joined Date</dt>
      <dd><xf:input ref="instance('test-data')/app-data/application-data/customers/form/customer/joined-date" /></dd>
    </dl>
    <div class="dialog-footer">
      <xf:trigger>
        <xf:label>Cancel</xf:label>
        <xf:hide ev:event="DOMActivate" dialog="customer-edit" />
      </xf:trigger>
      <xf:trigger>
        <xf:label>Save</xf:label>
        <xf:action ev:event="DOMActivate">
          <xf:action if="instance('test-data')/app-data/application-data/customers/form/customer/@id != ''">
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/app-data/application-data/customers/form/customer/@id]/@id" value="instance('test-data')/app-data/application-data/customers/form/customer/@id"/>
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/app-data/application-data/customers/form/customer/@id]/@email" value="instance('test-data')/app-data/application-data/customers/form/customer/@email"/>
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/app-data/application-data/customers/form/customer/@id]/@name" value="instance('test-data')/app-data/application-data/customers/form/customer/@name"/>
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/app-data/application-data/customers/form/customer/@id]/address" value="instance('test-data')/app-data/application-data/customers/form/customer/address"/>
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/app-data/application-data/customers/form/customer/@id]/joined-date" value="instance('test-data')/app-data/application-data/customers/form/customer/joined-date"/>
          </xf:action>
          <xf:action if="instance('test-data')/app-data/application-data/customers/form/customer/@id = ''">
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/customer/@id" value="concat('cust_', instance('test-data')/app-data/application-data/customers/form/next-customer-id)"/>
            <xf:insert nodeset="instance('test-data')/app-data/application-data/customers/form" origin="instance('test-data')/app-data/application-data/customers/form/customer" position="before"/>
            <xf:setvalue ref="instance('test-data')/app-data/application-data/customers/form/next-customer-id" value="instance('test-data')/app-data/application-data/customers/form/next-customer-id + 1"/>
          </xf:action>
          <xf:setvalue ref="instance('test-data')/current-customer-id" value="''" />
          <xf:hide dialog="customer-edit" />
        </xf:action>
      </xf:trigger>
    </div>
  </dialog>
  <dialog id="customer-info">
    <p>Customer "<xf:output value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-page-id]/@name" />"</p>
    <dl>
      <dt>Name</dt>
      <dd><xf:output value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-page-id]/@name" /></dd>
      <dt>Email</dt>
      <dd><xf:output value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-page-id]/@email" /></dd>
      <dt>Address</dt>
      <dd><xf:output value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-page-id]/address" /></dd>
      <dt>Joined Date</dt>
      <dd><xf:output value="instance('test-data')/app-data/application-data/customers/customer[@id = instance('test-data')/current-page-id]/joined-date" /></dd>
    </dl>
    <div class="dialog-footer">
      <xf:trigger>
        <xf:label>Close</xf:label>
        <xx:go-to ev:event="DOMActivate" route="'/customers'" />
      </xf:trigger>
    </div>
  </dialog>
</body>

</html>